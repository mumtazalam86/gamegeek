<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="EXPIRES" content="Sun, 19 Mar 2023 21:00:00 GMT" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Game Geek</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous" />
  <link rel="stylesheet" href="slick/slick.css" />
  <link rel="stylesheet" href="slick/slick-theme.css" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="icon" type="image/x-icon" href="whoo-icon-01.png" />
</head>
<style>
  .image_slider .slider_item {
    padding: 10px;
  }

  .image_slider .image-outer {
    position: relative;
    padding-bottom: 100%;
    display: flex !important;
  }

  .image_slider .image-outer img {
    object-fit: cover;
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
</style>

<body style="background-color: transparent;">
  <div class="container mt-2 mb-5">
    <div class="row">

      <div class="col-md-12 list-view-section">
        <div class="row bg-light header-row-section d-none">
          <div class="col-md-7"></div>
          <div class="col-md-5">
            <div class="pagination-bar d-flex">
              <a href="javascript:;" class="page-pre text-right">Pre &nbsp;</a>
              <div class="pagination-pages"></div>
              <a href="javascript:;" class="page-next text-right">&nbsp;Next</a>
            </div>
          </div>
        </div>
        <div class="image_slider">
        </div>
        <div class="col-md-12 cardList"></div>
      </div>
      <div class="col-md-12 detail-view-section d-none">
        <div class="show-list-view bg-light pointer-cursor p-3 mb-3">Go Back</div>
        <div class="game-details"></div>
      </div>
      <div class="text-center loader-spinner" style="margin: auto">
        <img src="./css/Reload-1s-200px.gif" width="50" height="50" class="image_id" class="text-center" />
      </div>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4"
    crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="slick/slick.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"
    integrity="sha512-qTXRIMyZIFb8iQcfjXWCO8+M5Tbc38Qi5WzdPOYZHIlZpzBHG3L3by84BBBOiRGiEb7KKtAOAs5qYdUiZiQNNQ=="
    crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
    integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
    crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
    integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
    crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
  <script>

    function getUrlVars() {
      var vars = [], hash;
      var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
      for (var i = 0; i < hashes.length; i++) {
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
      }
      return vars;
    }

    var boardgames;
    var boardgameBasicData;
    var paged = 0;

    var username = (getUrlVars()["username"]) ? getUrlVars()["username"] : 'Thitsa';
    $.ajax({
      //url: apiurl, 
      url: 'data.php',
      type: 'POST',
      data: 'username=' + username,
      cache: false,
      dataType: 'JSON',
      success: function (response) {
        if (response.status == 200) {
          boardgames = response.boardgame;
          boardgameBasicData = response.boardgameBasicData;
          // render pagination
          renderPaginationHTML();

          let boardgamesChunks = boardgames.slice(0, 10);
          $.each(boardgamesChunks, function (index, data) {
            renderListViewItem(data);
          });
          initiateSlickSlider();
        } else {
          alert(response.error);
        }
        hideloader();
      },
    });

    function hideloader() {
      $('.loader-spinner').addClass('d-none');
    }

    function showloader() {
      $('.loader-spinner').removeClass('d-none');
    }

    function renderPaginationHTML() {
      let numberofLinks = (boardgames.length / 10);
      // let leftLinks = (boardgames.length % 10);
      // if(leftLinks > 0){ numberofLinks += 1; }
      var paginationHTML = '';
      for (loop = 0; loop < numberofLinks; loop++) {
        paginationHTML += "<a href='javascript:;' class='page-number' data-paged='" + loop + "'> " + (loop + 1) + " </a> | ";
      }

      $('.pagination-pages').html(paginationHTML);
      $('.header-row-section').removeClass('d-none');
    }

    function renderListViewItem(data) {
      var objectid = data['@attributes']['objectid'];
      var boardgameDesc = data.description;
      if (boardgameDesc.length > 200) {
        textContent = boardgameDesc.substr(0, 300) + '...';
        // boardgamesContent = textContent.replace(/^\s+|\s+$/gm,'');
      }

      addSliderSlide(data);

      var boardGameDesigner = getBoardGameDesigner(data);
      var boardGameName = getBoardGameName(data);
      $(".cardList").append(`
          <div class="container mt-3">
            <div class="card" id="BoardgamesId${objectid}">
            <h6 class="text-center" data-objectid="${objectid}">${data.yearpublished}(Czech Games Edition)<span class="ml-5"><img src="./images/earshot-games_player.png" width="35px">${data.minplayers}-${data.maxplayers},<img src="./images/earshot-games_time.png"width="35px">${data.minplaytime}-${data.maxplaytime} ,<img src="./images/earshot-games_age.png"  width="35px">${data.age}+</span></h6> 
            <h6 class ="text-right ratingstar"></h6>    
            <h2 class="view-details pointer-cursor" data-objectid="${objectid}">${boardGameName}</h2>
            <h5 class="view-details" data-objectid="${objectid}">${boardGameDesigner}</h5>
            <div class="row">
              <div class="col-lg-3">
                <img src="${data.image}" class="img-fluid view-details pointer-cursor" data-objectid="${objectid}" >
                <div class="view-details" data-objectid="${objectid}"><h5 class="pointer-cursor text-danger">More</h5></div>
              </div>
               <div class="col-lg-9">  
                <div class="card-body">${textContent}</div>
               </div>
              </div>
            </div>
          </div>
        </div>
      </div>`);
    }

    function getBoardGameName(data) {
      var objectid = data['@attributes']['objectid'];
      return boardgameBasicData[objectid]['name'];
    }

    function getBoardGameDesigner(data) {
      if ($.isArray(data.boardgamedesigner)) {
        var boardgamedesigner = '';
        $.each(data.boardgamedesigner, function (index, value) {
          boardgamedesigner += (boardgamedesigner != '') ? ' & ' + value : value;
        });
        return boardgamedesigner;
      } else {
        return data.boardgamedesigner;
      }
    }


    function addSliderSlide(data) {
      var boardGameName = getBoardGameName(data);
      var objectid = data['@attributes']['objectid'];
      $('.image_slider').append(`<div class="slider_item"><div class="image-outer"><a href="#BoardgamesId${objectid}"><img src="${data.image}" class="img-fluid" id="sliderImg"></a></div><h6>${boardGameName}</h6></div>`);
    }

    function initiateSlickSlider() {
      $('.image_slider').slick({
        infinite: true,
        slidesToShow: 5,
        slidesToScroll: 3
      });
    }

    jQuery(document).ready(function ($) {

      $(document).on('click', ".page-number", function () {
        resetListPageContent($(this).data('paged'));
      });

      $(document).on('click', ".page-pre", function () {
        resetListPageContent(parseInt(paged) - 1);
      });

      $(document).on('click', ".page-next", function () {
        resetListPageContent(parseInt(paged) + 1);
      });

      function resetListPageContent(page) {
        paged = page;
        let nextIndex = (paged * 10);
        $(".cardList").html('');
        $('.image_slider').slick('unslick'); /* ONLY remove the classes and handlers added on initialize */
        $('.image_slider').html('');
        for (var loop = 0; loop < 10; loop++) {
          if (boardgames[nextIndex]) {
            renderListViewItem(boardgames[nextIndex]);
            nextIndex += 1;
          } else {
            return false;
          }
        }
        initiateSlickSlider();
      }


      $(document).on('click', ".show-list-view", function () {
        if(paged){
          resetListPageContent(paged);
        }
        toggleListViewSection();
        toggleDetailsViewSection();
      });

      $(document).on('click', ".view-details", function () {
        var objectid = $(this).data('objectid');
        $.each(boardgames, function (index, data) {
          var data_objectid = data['@attributes']['objectid'];
          if (objectid == data_objectid) {
            renderDetailsViewHTML(data);
            return;
          }
        });
      });
    });

    function renderDetailsViewHTML(data) {
      toggleListViewSection();
      toggleDetailsViewSection();
      var boardgameDesc = data.description;
      if (boardgameDesc.length > 200) {
        textContent = boardgameDesc.substr(0, 300) + '...';
      }
      var boardgameMechanic = "";
      function boardgameMechanicData(boardgameMechanic) {
        $.each(data.boardgamemechanic, function (gameMechanic, index) {
          boardgameMechanic += '<p class="ml-3">' + index + '</p>';
        });
        $('.boardgamemechanic').append(boardgameMechanic);
      }

      var boardGameName = getBoardGameName(data);
      var boardGameDesigner = getBoardGameDesigner(data);

      $('.game-details').html(`
        <div class="container">
            <div class="card">
               <div class="row">
                <div class="col-lg-4">
                  <h3>${boardGameName}</h3>
                  <h5>${boardGameDesigner}</h5>
                </div>
                <div class="col-lg-4">
                  <h6 class="text-center" data-objectid="${data.objectid}">${data.yearpublished}(Czech Games Edition)</h6>  
                </div>
                <div class="col-lg-4">
                  <span class="ml-5"><img src="./images/earshot-games_player.png" width="35px">${data.minplayers}-${data.maxplayers},<img src="./images/earshot-games_time.png"  width="35px">${data.minplaytime}-${data.maxplaytime},<img src="./images/earshot-games_age.png"  width="35px">${data.age}+</span>
                  <h6 class ="text-right ratingstar"></h6>
                </div>
              </div>
              <div class="row">
                <div class="col-lg-4">
                  <img src="${data.image}" class="img-fluid">
                </div>
                <div class="col-lg-4">
                  <div class="card-body">${textContent}</div>
                </div>
                <div class="col-lg-4">
                  <div class="btn-primary text-center">MEDIUM</div>
                  <div class="card">
                    <div class="card-header">MECHANICS</div>
                    <p class="boardgamemechanic"> </p>
                   </div>
                </div>
              </div>
            </div>
            <div class="related-gamaes">

           </div>
          </div>`);
      boardgameMechanicData(boardgameMechanic)
    }

    function toggleListViewSection() {
      $('.list-view-section').toggleClass('d-none');
    }
    function toggleDetailsViewSection() {
      $('.detail-view-section').toggleClass('d-none');
    }

    /*function ratingStar()
    {
      for(var i = 0; i < 4; i++){
        $('.ratingstar').append('<img src="./images/earshot-games_star_full.png" width="35px">');
      }
    }*/
  </script>
</body>

</html>